@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using Sfa.Das.Sas.Shared.Components.Extensions
@using Sfa.Das.Sas.Shared.Components.ViewModels.Css.Interfaces
@model Sfa.Das.Sas.Shared.Components.ViewModels.TrainingProviderDetailsViewModel
@inject ICssViewModel CssViewModel

<h2 class="@CssViewModel.HeadingLarge @CssViewModel.UtilitiesCss.Margin("Top",0)">Training Information</h2>

<dl class="@CssViewModel.List das-definition-list__results das-definition-list__results--black">
    <dt>Apprenticeship:</dt>
    <dd>@Model.Apprenticeship.Title</dd>
    <dt>Level:</dt>
    <dd>@Model.Apprenticeship.Level (equivalent to @Model.Apprenticeship.EquivalentText)</dd>

    <dt>Training options:</dt>
    <dd>
        <ul class="@CssViewModel.List @CssViewModel.ListBullet">
            <li><span class="@GetTrainingOptionsStatusClass("dayrelease",Model.DeliveryModes)">day release</span></li>
            <li><span class="@GetTrainingOptionsStatusClass("blockrelease",Model.DeliveryModes)">block release</span></li>
            <li><span class="@GetTrainingOptionsStatusClass("100percentemployer",Model.DeliveryModes)">at your location</span></li>
        </ul>
        <details class="@CssViewModel.Details">
            <summary class="@CssViewModel.DetailsSummary">
                <span class="@CssViewModel.DetailsSummaryText @CssViewModel.Link">Explain training options</span>
            </summary>
            <div class="@CssViewModel.DetailsText">
                <p><span class="das-provider__copy--black">Day release:</span> for example one day a week at the training provider's location.</p>
                <p><span class="das-provider__copy--black">Block release:</span> for example 3-4 weeks at the training provider's location.</p>
                <p><span class="das-provider__copy--black">At your location:</span> the training provider comes to your workplace.</p>
            </div>
        </details>
    </dd>

    <dt>Achievement rates:</dt>
    <dd>
        <div>Acheivement average: <span class="das-provider__copy--black">@Model.AchievementRate%</span></div>
        <progress class="das-provider__progress-bar" max="100" value="@Model.AchievementRate"></progress>

        <div>National average: <span class="das-provider__copy--black">@Model.NationalAchievementRate%</span></div>
        <progress class="das-provider__progress-bar" max="100" value="@Model.NationalAchievementRate"></progress>

        <details class="@CssViewModel.Details">
            <summary class="@CssViewModel.DetailsSummary">
                <span class="@CssViewModel.DetailsSummaryText @CssViewModel.Link">Explain achievement rates</span>
            </summary>
            <div class="@CssViewModel.DetailsText">
                <p>Percentage of apprentices who successfully achieved a similar apprenticeship with this training provider.</p>
                <p>Based on the latest data for 50 apprentices.</p>
                <p>Source: <a href="https://www.gov.uk/government/collections/sfa-national-success-rates-tables" target="_blank" rel="external">Skills Funding Agency apprenticeship achievement rates</a></p>
            </div>
        </details>
    </dd>
</dl>
<div class="das-provider-about">
    <h2 class="@CssViewModel.HeadingMedium">ABOUT THE APPRENTICESHIP</h2>

    @Html.MarkdownToHtml(Model.Apprenticeship.Overview);

</div>

<div class="das-provider-information">

    <h2 class="@CssViewModel.HeadingMedium">PROVIDER INFORMATION</h2>

    @Html.MarkdownToHtml(Model.MarketingInfo)


    @if (Model.NationalProvider == true)
    {
        <p>
            <span class="das-provider-tag--national">National</span> This training provider is willing to offer apprenticeship training across England.
        </p>

    }

</div>

<div class="das-provider-employers">

    <h2 class="@CssViewModel.HeadingMedium">What employers are saying</h2>

    <p>Based on <strong>@Model.Feedback.TotalFeedbackCount reviews from employers</strong> that work with this training provider.</p>

    <p><a href="#">Find out how these reviews work</a></p>

    <h2 class="@CssViewModel.HeadingXSmall">Overall rating from October 2018 to now</h2>

    <div class="das-provider-rating-reviews">

        <dl class="@CssViewModel.List">
            <dt class="das-provider-rating-reviews__definition-list--title">Excellent</dt>
            <dd class="das-provider-rating-reviews__definition-list--details">
                <progress class="das-provider__progress-bar das-provider__progress-bar--excellent" max="22" value="@Model.Feedback.ExcellentFeedbackCount"></progress>
                <span class="das-provider-rating-reviews__reviews-no">@Model.Feedback.ExcellentFeedbackCount reviews <span class="visually-hidden">out of @Model.Feedback.TotalFeedbackCount</span></span>
            </dd>
            <dt class="das-provider-rating-reviews__definition-list--title">Good</dt>
            <dd class="das-provider-rating-reviews__definition-list--details">
                <progress class="das-provider__progress-bar das-provider__progress-bar--good" max="22" value="@Model.Feedback.GoodFeedbackCount"></progress>
                <span class="das-provider-rating-reviews__reviews-no">@Model.Feedback.GoodFeedbackCount reviews <span class="visually-hidden">out of @Model.Feedback.TotalFeedbackCount</span></span>
            </dd>
            <dt class="das-provider-rating-reviews__definition-list--title">Poor</dt>
            <dd class="das-provider-rating-reviews__definition-list--details">
                <progress class="das-provider__progress-bar das-provider__progress-bar--poor" max="22" value="@Model.Feedback.PoorFeedbackCount"></progress>
                <span class="das-provider-rating-reviews__reviews-no">@Model.Feedback.PoorFeedbackCount reviews <span class="visually-hidden">out of @Model.Feedback.TotalFeedbackCount</span></span>
            </dd>
            <dt class="das-provider-rating-reviews__definition-list--title">Very poor</dt>
            <dd class="das-provider-rating-reviews__definition-list--details">
                <progress class="das-provider__progress-bar das-provider__progress-bar--very-poor" max="22" value="@Model.Feedback.VeryPoorFeedbackCount"></progress>
                <span class="das-provider-rating-reviews__reviews-no">@Model.Feedback.VeryPoorFeedbackCount review <span class="visually-hidden">out of @Model.Feedback.TotalFeedbackCount</span></span>
            </dd>
        </dl>

    </div>

    <div class="grid-row">
        <div class="grid-column-one-half">
            <h3 class="@CssViewModel.HeadingSmall">Strengths</h3>
            <ul class="@CssViewModel.List @CssViewModel.ListBullet">
                @foreach (var strength in Model.Feedback.Strengths)
                {
                    <li>@strength.Name <strong>(@strength.Count)</strong></li>
                }
            </ul>
        </div>
        <div class="grid-column-one-half">
            <h3 class="@CssViewModel.HeadingSmall">Things to improve</h3>
            <ul class="@CssViewModel.List @CssViewModel.ListBullet">
                @foreach (var weakness in Model.Feedback.Weaknesses)
                {
                    <li>@weakness.Name <strong>(@weakness.Count)</strong></li>
                }
            </ul>
        </div>
    </div>

    <dl class="@CssViewModel.List das-definition-list__results das-definition-list__results--black">

        <dt>Employer satisfaction:</dt>
        <dd>
            <div>@Model.EmployerSatisfactionMessage</div>
            @if (@Model.EmployerSatisfaction > 0)
            {
                <progress class="das-provider__progress-bar" max="100" value="@Model.EmployerSatisfaction"></progress>
            }
        </dd>

        <dt>Learner satisfaction:</dt>
        <dd>
            <div>@Model.LearnerSatisfactionMessage</div>
            @if (@Model.LearnerSatisfaction > 0)
            {
                <progress class="das-provider__progress-bar" max="100" value="@Model.LearnerSatisfaction"></progress>

            }
            <div class="satisfaction-source font-small">
                Source: <a href="https://www.gov.uk/government/statistical-data-sets/fe-choices-performance-indicators" target="_blank">Skills Funding Agency FE Choices</a>
            </div>
        </dd>

        <dt>Legal name:</dt>
        <dd>@Model.LegalName</dd>
    </dl>
</div>

<div class="das-provider-disclasimer">

    <h2 class="@CssViewModel.HeadingXSmall">Content disclaimer</h2>

    <p>
        Education and Skills Funding Agency cannot guarantee the accuracy of
        course information on this site and makes no representations about
        the quality of any courses which appear on the site. Education and Skills
        Funding Agency is not liable for any losses suffered as a result of any party
        relying on the course information provided.
    </p>
</div>

@functions
{

    string GetTrainingOptionsStatusClass(string trainingOption, IList<string> options)
    {
        var cssClass = "das-search-results__training-options";
        var classSuffix = string.Empty;

        if (options.Contains(trainingOption, StringComparer.OrdinalIgnoreCase))
        {
            classSuffix = "--tick";
        }
        else
        {
            classSuffix = "--cross";
        }

        return $"{cssClass}{classSuffix}";
    }


} 